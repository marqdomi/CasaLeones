{% extends 'layouts/_layout_admin.html' %}
{% block page_title %}Clientes{% endblock %}

{% block admin_content %}
{% from 'components/_page_header.html' import page_header %}
{% from 'components/_data_table.html' import data_table %}

{% call page_header('Clientes', breadcrumb=[('CRM', ''), ('Clientes', '')]) %}
  <a href="{{ url_for('clientes.cliente_nuevo') }}" class="cl-btn cl-btn--primary">
    <i data-lucide="plus" class="icon-sm"></i> Nuevo Cliente
  </a>
{% endcall %}

{% call(row) data_table(
    items=clientes,
    columns=[
      ('Nombre', 'nombre', true),
      ('Teléfono', none, false),
      ('Email', none, false),
      ('RFC', none, false),
      ('Visitas', 'visitas', true),
      ('Total Gastado', 'total_gastado', true),
      ('', none, false)
    ],
    empty_text='No hay clientes registrados',
    empty_icon='users',
    search_placeholder='Buscar cliente…',
    id='tblClientes'
) %}
  <td>{{ row.nombre }}</td>
  <td>{{ row.telefono or '—' }}</td>
  <td>{{ row.email or '—' }}</td>
  <td>{{ row.rfc or '—' }}</td>
  <td>{{ row.visitas }}</td>
  <td>${{ '%.2f'|format(row.total_gastado or 0) }}</td>
  <td class="text-end">
    <a href="{{ url_for('clientes.perfil_cliente', id=row.id) }}" class="cl-btn cl-btn--sm cl-btn--ghost" title="Perfil">
      <i data-lucide="eye" class="icon-sm"></i>
    </a>
    <a href="{{ url_for('clientes.cliente_editar', id=row.id) }}" class="cl-btn cl-btn--sm cl-btn--ghost" title="Editar">
      <i data-lucide="pencil" class="icon-sm"></i>
    </a>
  </td>
{% endcall %}
{% endblock %}
