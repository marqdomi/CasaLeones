{% extends 'layouts/_layout_admin.html' %}
{% block page_title %}{{ cliente.nombre }}{% endblock %}

{% block admin_content %}
{% from 'components/_page_header.html' import page_header %}
{% from 'components/_kpi_card.html' import kpi_card %}
{% from 'components/_badge.html' import status_badge %}
{% from 'components/_empty_state.html' import empty_state %}

{% call page_header(cliente.nombre, breadcrumb=[('CRM', ''), ('Clientes', url_for('clientes.lista_clientes')), (cliente.nombre, '')]) %}
  <a href="{{ url_for('clientes.cliente_editar', id=cliente.id) }}" class="cl-btn cl-btn--ghost cl-btn--sm">
    <i data-lucide="pencil" class="icon-sm"></i> Editar
  </a>
{% endcall %}

<div class="row g-4 mb-4">
  <div class="col-md-6">
    <div class="cl-card">
      <div class="cl-card__body">
        <p><strong>Teléfono:</strong> {{ cliente.telefono or '—' }}</p>
        <p><strong>Email:</strong> {{ cliente.email or '—' }}</p>
        <p><strong>RFC:</strong> {{ cliente.rfc or '—' }}</p>
        <p class="mb-0"><strong>Desde:</strong> {{ cliente.fecha_registro.strftime('%Y-%m-%d') if cliente.fecha_registro else '—' }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    {{ kpi_card('Visitas', cliente.visitas, icon='repeat', color='info') }}
  </div>
  <div class="col-md-3">
    {{ kpi_card('Total Gastado', '$' ~ '%.2f'|format(cliente.total_gastado or 0), icon='wallet', color='success') }}
  </div>
</div>

{% if cliente.notas %}
<div class="cl-card mb-4">
  <div class="cl-card__body">
    <strong>Notas:</strong> {{ cliente.notas }}
  </div>
</div>
{% endif %}

<h5 class="mb-3">Últimas Órdenes</h5>
{% if ordenes %}
<div class="table-responsive">
  <table class="cl-table cl-table--striped cl-table--hover">
    <thead>
      <tr><th>Orden</th><th>Fecha</th><th>Estado</th><th>Total</th></tr>
    </thead>
    <tbody>
      {% for o in ordenes %}
      <tr>
        <td>#{{ o.id }}</td>
        <td>{{ o.tiempo_registro.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ status_badge(o.estado) }}</td>
        <td>${{ '%.2f'|format(o.total or 0) }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
{{ empty_state('Sin órdenes registradas', icon='receipt') }}
{% endif %}
{% endblock %}
