{% extends 'layouts/_layout_admin.html' %}
{% block page_title %}Mesas{% endblock %}

{% block admin_content %}
{% from 'components/_page_header.html' import page_header %}
{% from 'components/_data_table.html' import data_table %}
{% from 'components/_badge.html' import badge, status_badge %}
{% from 'components/_modal.html' import confirm_modal %}

{% call page_header('Mesas', breadcrumb=[('Catálogo', ''), ('Mesas', '')]) %}
  <a href="{{ url_for('admin.mesa_nuevo') }}" class="cl-btn cl-btn--primary">
    <i data-lucide="plus" class="icon-sm"></i> Nueva Mesa
  </a>
{% endcall %}

{% call(row) data_table(
    items=mesas,
    columns=[
      ('Número', 'numero', true),
      ('Capacidad', 'capacidad', true),
      ('Zona', 'zona', false),
      ('Estado', none, false),
      ('', none, false)
    ],
    empty_text='No hay mesas registradas',
    empty_icon='grid-3x3',
    search_placeholder='Buscar mesa…',
    id='tblMesas'
) %}
  <td>Mesa {{ row.numero }}</td>
  <td>{{ row.capacidad }} pers.</td>
  <td>{{ row.zona or '—' }}</td>
  <td>{{ status_badge(row.estado) }}</td>
  <td class="text-end">
    <a href="{{ url_for('admin.mesa_editar', id=row.id) }}" class="cl-btn cl-btn--sm cl-btn--ghost" title="Editar">
      <i data-lucide="pencil" class="icon-sm"></i>
    </a>
    <button class="cl-btn cl-btn--sm cl-btn--ghost cl-btn--danger"
            data-bs-toggle="modal" data-bs-target="#deleteModal"
            data-action="{{ url_for('admin.mesa_eliminar', id=row.id) }}"
            title="Eliminar">
      <i data-lucide="trash-2" class="icon-sm"></i>
    </button>
  </td>
{% endcall %}

{{ confirm_modal(id='deleteModal', title='¿Eliminar mesa?', body='Esta acción no se puede deshacer.', confirm_text='Eliminar', form_action='#') }}

<script>
document.getElementById('deleteModal').addEventListener('show.bs.modal', function(e){
  this.querySelector('form').setAttribute('action', e.relatedTarget.getAttribute('data-action'));
});
</script>
{% endblock %}
