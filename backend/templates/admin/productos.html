{% extends 'layouts/_layout_admin.html' %}
{% block page_title %}Productos{% endblock %}

{% block admin_content %}
{% from 'components/_page_header.html' import page_header %}
{% from 'components/_data_table.html' import data_table %}
{% from 'components/_modal.html' import confirm_modal %}

{% call page_header('Productos', breadcrumb=[('Catálogo', ''), ('Productos', '')]) %}
  <a href="{{ url_for('admin.producto_nuevo') }}" class="cl-btn cl-btn--primary">
    <i data-lucide="plus" class="icon-sm"></i> Nuevo Producto
  </a>
{% endcall %}

{% call(row) data_table(
    items=productos,
    columns=[
      ('Nombre', 'nombre', true),
      ('Precio', 'precio', true),
      ('Unidad', 'unidad', false),
      ('Categoría', none, false),
      ('Estación', none, false),
      ('', none, false)
    ],
    empty_text='No hay productos registrados',
    empty_icon='package',
    search_placeholder='Buscar producto…',
    id='tblProductos'
) %}
  <td>{{ row.nombre }}</td>
  <td>${{ '%.2f'|format(row.precio) }}</td>
  <td>{{ row.unidad or '—' }}</td>
  <td>{{ row.categoria.nombre if row.categoria else '—' }}</td>
  <td>{{ row.estacion.nombre if row.estacion else '—' }}</td>
  <td class="text-end">
    <a href="{{ url_for('admin.producto_editar', id=row.id) }}" class="cl-btn cl-btn--sm cl-btn--ghost" title="Editar">
      <i data-lucide="pencil" class="icon-sm"></i>
    </a>
    <button class="cl-btn cl-btn--sm cl-btn--ghost cl-btn--danger"
            data-bs-toggle="modal" data-bs-target="#deleteModal"
            data-action="{{ url_for('admin.producto_eliminar', id=row.id) }}"
            title="Eliminar">
      <i data-lucide="trash-2" class="icon-sm"></i>
    </button>
  </td>
{% endcall %}

{{ confirm_modal(id='deleteModal', title='¿Eliminar producto?', body='Esta acción no se puede deshacer.', confirm_text='Eliminar', form_action='#') }}

<script>
document.getElementById('deleteModal').addEventListener('show.bs.modal', function(e){
  this.querySelector('form').setAttribute('action', e.relatedTarget.getAttribute('data-action'));
});
</script>
{% endblock %}
