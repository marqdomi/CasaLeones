{% extends 'layouts/_layout_admin.html' %}
{% block page_title %}Recetas{% endblock %}

{% block admin_content %}
{% from 'components/_page_header.html' import page_header %}
{% from 'components/_data_table.html' import data_table %}
{% from 'components/_badge.html' import badge %}

{{ page_header('Recetas Estándar', breadcrumb=[('Inventario', ''), ('Recetas', '')], subtitle='Define qué ingredientes y cantidades usa cada producto.') }}

{% call(row) data_table(
    items=productos,
    columns=[
      ('Producto', 'nombre', true),
      ('Ingredientes', none, false),
      ('', none, false)
    ],
    empty_text='No hay productos con recetas',
    empty_icon='book-open',
    search_placeholder='Buscar producto…',
    id='tblRecetas'
) %}
  <td>
    <strong>{{ row.nombre }}</strong>
    <br><small style="color:var(--cl-text-secondary)">${{ '%.2f'|format(row.precio) }}</small>
  </td>
  <td>
    {% if row.receta_items %}
      {% for r in row.receta_items %}
        {{ badge(r.ingrediente.nombre ~ ': ' ~ '%.4f'|format(r.cantidad_por_unidad) ~ ' ' ~ r.ingrediente.unidad, 'gray') }}
      {% endfor %}
    {% else %}
      <span style="color:var(--cl-text-tertiary)">Sin receta</span>
    {% endif %}
  </td>
  <td class="text-end">
    <a href="{{ url_for('inventario.editar_receta', producto_id=row.id) }}" class="cl-btn cl-btn--sm cl-btn--ghost" title="Editar receta">
      <i data-lucide="pencil" class="icon-sm"></i>
    </a>
  </td>
{% endcall %}
{% endblock %}
