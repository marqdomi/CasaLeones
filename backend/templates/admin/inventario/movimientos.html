{% extends 'layouts/_layout_admin.html' %}
{% block page_title %}Movimientos{% endblock %}

{% block admin_content %}
{% from 'components/_page_header.html' import page_header %}
{% from 'components/_badge.html' import badge %}

{{ page_header('Historial de Movimientos', breadcrumb=[('Inventario', ''), ('Ingredientes', url_for('inventario.lista_ingredientes')), ('Movimientos', '')]) }}

<div class="table-responsive">
  <table class="cl-table cl-table--striped cl-table--hover">
    <thead>
      <tr>
        <th>Fecha</th><th>Ingrediente</th><th>Tipo</th>
        <th>Cantidad</th><th>Motivo</th><th>Usuario</th>
      </tr>
    </thead>
    <tbody>
      {% for m in movimientos.items %}
      <tr>
        <td>{{ m.fecha.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ m.ingrediente.nombre }}</td>
        <td>
          {% if m.tipo == 'merma' %}
            {{ badge('Merma', 'warning', icon='alert-triangle') }}
          {% elif m.tipo == 'entrada' %}
            {{ badge('Entrada', 'success', icon='package-plus') }}
          {% elif m.tipo == 'salida_venta' %}
            {{ badge('Salida Venta', 'info', icon='shopping-cart') }}
          {% else %}
            {{ badge(m.tipo|capitalize, 'gray') }}
          {% endif %}
        </td>
        <td>{{ '%.4f'|format(m.cantidad) }} {{ m.ingrediente.unidad }}</td>
        <td>{{ m.motivo or '—' }}</td>
        <td>{{ m.usuario.nombre if m.usuario else '—' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if movimientos.pages > 1 %}
<nav aria-label="Paginación" class="mt-3">
  <ul class="pagination pagination-sm justify-content-center">
    {% for page in movimientos.iter_pages() %}
      {% if page %}
        <li class="page-item {% if page == movimientos.page %}active{% endif %}">
          <a class="page-link" href="?page={{ page }}">{{ page }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">…</span></li>
      {% endif %}
    {% endfor %}
  </ul>
</nav>
{% endif %}
{% endblock %}
