{% block scripts %}
<script src="/socket.io/socket.io.js"></script>
<script>
$(document).ready(function() {
    var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);

    socket.on('connect', function() {
        console.log('Conectado al servidor de WebSockets! (Comal)');
    });

    socket.on('disconnect', function() {
        console.log('Desconectado del servidor de WebSockets. (Comal)');
    });

    function cargarOrdenesPendientes() {
        let fragmentUrl = "/cocina/comal/fragmento_ordenes"; // Específico para comal
        console.log(`Recibido evento, actualizando órdenes para Comal desde ${fragmentUrl}...`);
        $.ajax({
            url: fragmentUrl,
            type: 'GET',
            success: function(newHtml) {
                $('#ordenes-pendientes-lista').html(newHtml);
                console.log('Lista de órdenes de Comal actualizada.');
            },
            error: function(xhr, status, error) {
                console.error("Error al actualizar la lista de órdenes de Comal:", error);
            }
        });
    }

    socket.on('nueva_orden_cocina', function(data) {
        console.log('Evento nueva_orden_cocina recibido en Comal:', data);
        cargarOrdenesPendientes();
    });

    socket.on('item_listo_notificacion', function(data) {
        console.log('Evento item_listo_notificacion recibido en Comal:', data);
        cargarOrdenesPendientes();
    });

    $('#ordenes-pendientes-lista').on('click', '.marcar-listo-btn', function() {
        var itemId = $(this).data('item-id');
        $.ajax({
            url: '/cocina/marcar_listo/' + itemId,
            type: 'POST',
            success: function(response) {
                if(response.success) {
                    console.log('Item ' + itemId + ' marcado como listo, esperando recarga por evento.');
                } else {
                    alert('Error al marcar como listo: ' + (response.mensaje || 'Error desconocido'));
                }
            },
            error: function() {
                alert('Error de comunicación al marcar como listo.');
            }
        });
    });
});
</script>
{% endblock %}
